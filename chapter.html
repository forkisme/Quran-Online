<script>
    let chaptersData = []; // To store chapter data

    // Function to fetch the chapters data from the remote JSON
    function fetchChaptersData() {
        const chaptersUrl = "https://raw.githubusercontent.com/itzfew/Quran-Online/refs/heads/main/source/hadiths/bukhari/chapters.json";
        fetch(chaptersUrl)
            .then(response => response.json())
            .then(data => {
                chaptersData = data.collection.books; // Storing the books data
                initializeViewer();
            })
            .catch(error => {
                console.error('Error fetching chapters data:', error);
                document.getElementById('hadithResult').innerHTML = '<p class="error">Failed to load the chapters data. Please try again later.</p>';
                document.getElementById('loading').style.display = 'none';
            });
    }

    // Function to get the book and chapter from URL parameters
    function getURLParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const book = urlParams.get('book');
        const chapter = urlParams.get('chapter');
        return { book, chapter };
    }

    // Function to fetch and display the hadiths from the given book and chapter
    function fetchHadiths(bookSlug, chapterNumber) {
        const url = `https://raw.githubusercontent.com/itzfew/Quran-Online/refs/heads/main/source/hadiths/${bookSlug}/${chapterNumber}.json`;
        fetch(url)
            .then(response => response.json())
            .then(data => {
                displayHadiths(data, bookSlug);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('hadithResult').innerHTML = '<p class="error">Failed to load the hadiths. Please try again later.</p>';
                document.getElementById('loading').style.display = 'none';
            });
    }

    // Function to display the hadiths on the page
    function displayHadiths(data, bookSlug) {
        const hadithResult = document.getElementById('hadithResult');
        const loading = document.getElementById('loading');

        // Hide loading spinner
        loading.style.display = 'none';

        // Add mapping for book slugs to full names
        const bookSlugToName = {
            bukhari: "Sahih al-Bukhari",
            muslim: "Sahih Muslim",
            tirmidhi: "Jami` at-Tirmidhi",
            // Add other mappings here
        };

        // Find the book name based on the book slug
        const bookName = bookSlugToName[bookSlug.toLowerCase()] || 'Unknown Book';

        // Check if the data contains hadiths
        if (data.hadiths && data.hadiths.length > 0) {
            let htmlContent = `
                <div class="header-meta">
                    <h2>${bookName} <span style="font-size: 18px;">(Chapter: ${data.metadata.english.introduction})</span></h2>
                    <p><strong>Author:</strong> ${data.metadata.english.author}</p>
                    <p><strong>Introduction:</strong> ${data.metadata.english.introduction}</p>
                </div>
            `;
            
            // Loop through and display each hadith
            data.hadiths.forEach(hadith => {
                htmlContent += `
                    <div class="hadith">
                        <h3>Hadith #${hadith.id}</h3>
                        <p class="arabic-text"><strong>Arabic:</strong> ${hadith.arabic}</p>
                        <p class="english-text"><strong>English:</strong> ${hadith.english.text}</p>
                    </div>
                `;
            });

            hadithResult.innerHTML = htmlContent;
        } else {
            hadithResult.innerHTML = '<p>No Hadiths found for this chapter.</p>';
        }
    }

    // Initialize the viewer by fetching chapters data and URL parameters
    function initializeViewer() {
        const { book, chapter } = getURLParams();
        if (book && chapter) {
            fetchHadiths(book, chapter);
        } else {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('hadithResult').innerHTML = '<p class="error">Please specify both the book and chapter number in the URL (e.g., ?book=bukhari&chapter=10).</p>';
        }
    }

    // On page load, fetch the chapters data and initialize the viewer
    window.onload = fetchChaptersData;
</script>
